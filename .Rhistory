range(dp$transit_time, na.rm = TRUE)
max <- dp %>%
arrange(transit_time)
max <- dp %>%
arrange(transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
dp <- d3 %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(dp$transit_time, na.rm = TRUE)
dp$transit_time <- as.numeric(dp$transit_time)
range(dp$transit_time, na.rm = TRUE)
max <- dp %>%
arrange(transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
head(max)
max <- dp %>%
arrange(-transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
head(max)
c1 <- filter(d3, TagID == 13728)
c1 <- c1 %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(c1$transit_time, na.rm = TRUE)
c1$transit_time <- as.numeric(dp$transit_time)
c1$transit_time <- as.numeric(c1$transit_time)
range(c1$transit_time, na.rm = TRUE)
View(c1)
ggplot(dp2, aes(x = Sp, y = meanrate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 3, width= 0.8,    alpha = 0.5) + facet_wrap(~detyear)
head(max) # there are some crazy values here - need to go back and spot-check with individual fish.
2834/24
c1 <- filter(d3, TagID == 56486)
c1 <- c1 %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(c1$transit_time, na.rm = TRUE)
c1$transit_time <- as.numeric(c1$transit_time)
range(c1$transit_time, na.rm = TRUE)
View(c1)
head(d3)
dp <- d3 %>%
filter(residence != 0) %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(dp$transit_time, na.rm = TRUE)
2702/24
summary(dp$transit_time)
dp$transit_time <- as.numeric(dp$transit_time)
range(dp$transit_time, na.rm = TRUE)
summary(dp$transit_time)
max <- dp %>%
arrange(-transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
head(max) # there are some crazy values here - need to go back and spot-check with individual fish.
c1 <- filter(d3, TagID == 56480)
c1 <- filter(dp, TagID == 56480)
View(c1)
c1 <- filter(dp, TagID == 2876)
2449/24
c1 <- filter(dp, TagID == 56490)
106.4-105.96
50*24
dp <- d3 %>%
filter(residence != 0) %>% # filter out single detections
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(dp$transit_time, na.rm = TRUE)
dp$transit_time <- as.numeric(dp$transit_time)
range(dp$transit_time, na.rm = TRUE)
max <- dp %>%
arrange(-transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
dp <- dp %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
filter(transit_time < 50*24) %>% # filters out transits greater than 50 days
mutate(move_num = cumsum(!duplicated(Station) | c(F, abs(diff(Rkm)) > 0.50))) %>% # skip the BC transits
ungroup() %>%
group_by(detyear, TagID, move_num) %>%
slice(length(move_num)) %>%
ungroup()
range(dp$transit_time)
922/24
max <- dp %>%
arrange(transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
head(max) # there are some crazy values here - need to go back and spot-check with individual fish.
c1 <- filter(dp, TagID == 13642)
c1 <- filter(dp, TagID == 13644)
c1 <- filter(dp, TagID == 13640)
dp <- d3 %>%
filter(residence != 0) %>% # filter out single detections
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(dp$transit_time, na.rm = TRUE)
dp$transit_time <- as.numeric(dp$transit_time)
range(dp$transit_time, na.rm = TRUE)
dp <- dp %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
filter(transit_time < 50*24, transit_time > 0) %>% # filters out transits greater than 50 days
mutate(move_num = cumsum(!duplicated(Station) | c(F, abs(diff(Rkm)) > 0.50))) %>% # skip the BC transits
ungroup() %>%
group_by(detyear, TagID, move_num) %>%
slice(length(move_num)) %>%
ungroup()
range(dp$transit_time) # we still have negative transit times, even after filtering for BC_joints - let's see what that's about:
max <- dp %>%
arrange(transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
head(max) # there are some crazy values here - need to go back and spot-check with individual fish.
c1 <- filter(dp, TagID == 20157)
106.4-105.9
dp <- d3 %>%
filter(residence != 0) %>% # filter out single detections
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(dp$transit_time, na.rm = TRUE)
dp$transit_time <- as.numeric(dp$transit_time)
range(dp$transit_time, na.rm = TRUE)
dp <- dp %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
filter(transit_time < 50*24, transit_time > 0) %>% # filters out transits greater than 50 days
mutate(move_num = cumsum(!duplicated(Station) | c(F, abs(diff(Rkm)) > 0.60))) %>% # skip the BC transits
ungroup() %>%
group_by(detyear, TagID, move_num) %>%
slice(length(move_num)) %>%
ungroup()
range(dp$transit_time) # we still have negative transit times, even after filtering for BC_joints - let's see what that's about:
max <- dp %>%
arrange(transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
head(max) # there are some crazy values here - need to go back and spot-check with individual fish.
c1 <- filter(dp, TagID == 20157)
dp2 <- dp %>%
group_by(detyear, TagID) %>%
arrange(move_num) %>%
mutate(diffRkm = abs(lead(Rkm) - Rkm),
rate = diffRkm/transit_time) %>%
ungroup
range(dp2$rate)
range(dp2$rate, na.rm = TRUE)
dp <- d3 %>%
filter(residence != 0) %>% # filter out single detections
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(dp$transit_time, na.rm = TRUE)
dp$transit_time <- as.numeric(dp$transit_time)
range(dp$transit_time, na.rm = TRUE)
max <- dp %>%
arrange(transit_time) %>%
select(TagID, Station, arrival, departure, transit_time, Rkm)
head(max) # there are some crazy values here - need to go back and spot-check with individual fish.
dp <- dp %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
filter(transit_time < 50*24, transit_time > 0) %>% # filters out transits greater than 50 days
mutate(move_num = cumsum(!duplicated(Station) | c(F, abs(lead(Rkm) - Rkm) > 0.60))) %>% # skip the BC transits
ungroup() %>%
group_by(detyear, TagID, move_num) %>%
slice(length(move_num)) %>%
ungroup()
dp <- dp %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
filter(transit_time < 50*24, transit_time > 0) %>% # filters out transits greater than 50 days
mutate(move_num = cumsum(!duplicated(Station) | c(F, abs(diff(Rkm)) > 0.60))) %>% # skip the BC transits
ungroup() %>%
group_by(detyear, TagID, move_num) %>%
slice(length(move_num)) %>%
ungroup()
range(dp$transit_time) # we still have negative transit times, even after filtering for BC_joints - let's see what that's about:
dp2 <- dp %>%
group_by(detyear, TagID) %>%
arrange(move_num) %>%
mutate(diffRkm = abs(lead(Rkm) - Rkm),
rate = diffRkm/transit_time) %>%
ungroup
range(dp2$rate, na.rm = TRUE)
dp3 <- dp2 %>%
group_by(detyear, TagID) %>%
summarise(meanrate = mean(rate, na.rm = TRUE))
range(dp3$meanrate, na.rm = TRUE)
ggplot(dp2, aes(x = Sp, y = meanrate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 3, width= 0.8,    alpha = 0.5) + facet_wrap(~detyear)
ggplot(dp3, aes(x = Sp, y = meanrate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 3, width= 0.8,    alpha = 0.5) + facet_wrap(~detyear)
dp3 <- dp2 %>%
group_by(detyear, TagID) %>%
mutate(meanrate = mean(rate))
range(dp3$meanrate, na.rm = TRUE)
dp3 <- dp2 %>%
group_by(detyear, TagID) %>%
mutate(meanrate = mean(rate, na.rm = TRUE))
range(dp3$meanrate, na.rm = TRUE)
ggplot(dp3, aes(x = Sp, y = meanrate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 3, width= 0.8,    alpha = 0.5) + facet_wrap(~detyear)
ggplot(dp3, aes(x = Sp, y = meanrate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 3, width= 0.8,    alpha = 0.5) + facet_wrap(~detyear, scales = "free_y")
dp2 <- dp %>%
group_by(detyear, TagID) %>%
arrange(move_num) %>%
mutate(diffRkm = abs(lead(Rkm) - Rkm),
rate = diffRkm/transit_time) %>%
ungroup %>%
filter(rate < 50)
range(dp2$rate, na.rm = TRUE)
dp2 <- dp %>%
group_by(detyear, TagID) %>%
arrange(move_num) %>%
mutate(diffRkm = abs(lead(Rkm) - Rkm),
rate = diffRkm/transit_time) %>%
ungroup %>%
filter(rate < 100)
range(dp2$rate, na.rm = TRUE)
dp3 <- dp2 %>%
group_by(detyear, TagID) %>%
mutate(meanrate = mean(rate, na.rm = TRUE))
range(dp3$meanrate, na.rm = TRUE)
ggplot(dp3, aes(x = Sp, y = meanrate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 3, width= 0.8,    alpha = 0.5) + facet_wrap(~detyear, scales = "free_y")
ggplot(dp3, aes(x = Sp, y = meanrate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 3, width= 0.8,    alpha = 0.5) + facet_wrap(~detyear)
ggplot(dp3, aes(x = Sp, y = meanrate)) +
geom_density(aes(color = Sp))
ggplot(dp3) +
geom_density(aes(y = meanrate, color = Sp))
ggplot(dp3) +
geom_density(aes(x = Sp, y = meanrate, color = Sp))
ggplot(dp3) +
geom_density(aes(x = meanrate, color = Sp))
ggplot(dp3) +
geom_density(aes(x = meanrate, color = Sp)) + facet_wrap(~detyear, scales = "free_x")
ggplot(dp3) +
geom_density(aes(x = rate, color = Sp)) + facet_wrap(~detyear, scales = "free_x")
ggplot(dp3, aes(x = Sp, y = rate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 2, width= 0.8,    alpha = 0.1) + facet_wrap(~detyear)
library(rethinking)
?rethinking::map
m <- map(flist = alist(
rate ~ dnorm(mean = mu, sd = sigma) ,
mu <- a + b*Sp + b1*detyear,
c(a, b) ~ dnorm(0, 10) ,
sigma ~ dcauchy(0,1)
),
start = list(a=1, sigma = 5), data = dp3 )
data("WaffleDivorce")
head(WaffleDivorce)
data <- filter(dp3, detyear == "2013")
head(data)
data$dSp <- ifelse(data$Sp == "wst", 1, 0)
plot(rate~dSp, data = data())
plot(rate~dSp, data = data
)
plot(rate~Sp, data = data)
plot(rate~as.factor(Sp), data = data)
data("Howell1")
plot(height~weight, data = Howell1)
m <- map(flist = alist(
rate ~ dnorm(mean = mu, sd = sigma) ,
mu <- a + bSp*dSp,
a ~ dnorm(0, 10) ,
bSp ~ dnorm(0, 1),
sigma ~ dunif(0,10)
),
start = list(a=1, sigma = 5), data = data )
d1 <- filter(dp3, detyear == "2013")
d1$dSp <- ifelse(data$Sp == "wst", 1, 0)
d1 <- as.data.frame(d1)
m <- map(flist = alist(
rate ~ dnorm(mean = mu, sd = sigma) ,
mu <- a + bSp*dSp,
a ~ dnorm(0, 10) ,
bSp ~ dnorm(0, 1),
sigma ~ dunif(0,10)
),
start = list(a=1, sigma = 5), data = d1 )
precis(m)
d1$dSp <- ifelse(data$Sp == "chn", 1, 0)
d1$dSp <- ifelse(d1$Sp == "chn", 1, 0)
m <- map(flist = alist(
rate ~ dnorm(mean = mu, sd = sigma) ,
mu <- a + bSp*dSp,
a ~ dnorm(0, 10) ,
bSp ~ dnorm(0, 1),
sigma ~ dunif(0,10)
),
start = list(a=1, sigma = 5), data = d1 )
precis(m)
d1all <- as.data.frame(dp3)
d1all$dSp <- ifelse(d1all$Sp == "chn", 1, 0)
m1a <- map(flist = alist(
rate ~ dnorm(mean = mu, sd = sigma) ,
mu <- a + bSp*dSp,
a ~ dnorm(0, 10) ,
bSp ~ dnorm(0, 1),
sigma ~ dunif(0,10)
),
start = list(a=1, sigma = 5), data = d1all )
precis(m1a)
head(d1all)
plot(transit_time ~ rate, data = d1all)
range(d1all$transit_time)
d1all <- dplyr::filter(d1all, transit_time > 0)
range(d1all$transit_time)
plot(rate ~ transit_time, data = d1all)
plot(transit_time ~ Sp, data = d1all)
plot(transit_time ~ as.factor(Sp), data = d1all)
library(tidyverse)
library(ybp)
library(fishtrackr)
library(lubridate)
library(viridis)
library(beepr)
d <- all69khz_grouped
d2 <- d %>%
group_by(TagID) %>%
filter(DateTimeUTC >= DateTagged) %>%
arrange(DateTimeUTC)
d3 <- fishpaths(d2, d2$TagID, d2$Station)
beep()
d3$residence <- d3$departure - d3$arrival
units(d3$residence) = "days"
sheds <- filter(d3, residence > 7) # filter out encounters equal to or longer than 7 consecutive days
len(sheds$TagID)
d3 <- filter(d2, !(TagID %in% sheds$TagID))
len(d3$TagID) # should be 221-6 = 215
d3 <- fishpaths(d3, d3$TagID, d3$Station)
d3 <- d3 %>%
arrange(arrival) %>%
mutate(detyear =
ifelse(
departure > "2011-07-01 00:00:00" & departure < "2012-06-30 00:00:00", "2011",
ifelse(
departure > "2012-07-01 00:00:00" & departure < "2013-06-30 00:00:00", "2012",
ifelse(
departure > "2013-07-01 00:00:00" & .$departure < "2014-06-30 00:00:00", "2013",
ifelse(
departure > "2014-07-01 00:00:00" & departure < "2015-06-30 00:00:00", "2014", "2015"
)
) )
d3 <- d3 %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(residence = departure - arrival) %>%
ungroup()
units(d3$residence) <- "hours"
head(d3)
dp <- d3 %>%
group_by(detyear, TagID) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours"))
dp <- d3 %>%
filter(residence != 0) %>% # filter out single detections
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(dp$transit_time, na.rm = TRUE)
dp$transit_time <- as.numeric(dp$transit_time)
range(dp$transit_time, na.rm = TRUE)
dp <- dp %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
filter(transit_time < 50*24, transit_time > 0) %>% # filters out transits greater than 50 days
mutate(move_num = cumsum(!duplicated(Station) | c(F, abs(diff(Rkm)) > 0.60))) %>% # skip the BC transits
ungroup() %>%
group_by(detyear, TagID, move_num) %>%
slice(length(move_num)) %>%
ungroup()
dp2 <- dp %>%
group_by(detyear, TagID) %>%
arrange(move_num) %>%
mutate(diffRkm = abs(lead(Rkm) - Rkm),
rate = diffRkm/transit_time) %>%
ungroup %>%
filter(rate < 100)
range(dp2$rate, na.rm = TRUE)
dp3 <- dp2 %>%
group_by(detyear, TagID) %>%
mutate(meanrate = mean(rate, na.rm = TRUE))
range(dp3$meanrate, na.rm = TRUE)
ggplot(dp3, aes(x = Sp, y = rate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 2, width= 0.8,    alpha = 0.1) + facet_wrap(~detyear)
ggplot(dp3) +
geom_density(aes(x = rate, color = Sp)) + facet_wrap(~detyear, scales = "free_x")
head(dp3)
ggplot(dp2, aes(x = Sp, y = rate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 2, width= 0.8,    alpha = 0.1) + facet_wrap(~detyear)
head(dp)
detach("package:fishtrackr", unload=TRUE)
library(fishtrackr)
d <- all69khz_grouped
d2 <- d %>%
arrange(DateTimeUTC) %>%
mutate(detyear =
ifelse(
DateTimeUTC > "2011-07-01 00:00:00" & DateTimeUTC < "2012-06-30 00:00:00", "2011",
ifelse(
DateTimeUTC > "2012-07-01 00:00:00" & DateTimeUTC < "2013-06-30 00:00:00", "2012",
ifelse(
DateTimeUTC > "2013-07-01 00:00:00" & .$DateTimeUTC < "2014-06-30 00:00:00", "2013",
ifelse(
DateTimeUTC > "2014-07-01 00:00:00" & DateTimeUTC < "2015-06-30 00:00:00", "2014", "2015"
)
) )
d2 <- d %>%
group_by(TagID) %>%
filter(DateTimeUTC >= DateTagged) %>%
arrange(DateTimeUTC)
d3 <- fishpaths(d2, d2$TagID, d2$Station)
beep()
d3$residence <- d3$departure - d3$arrival
units(d3$residence) = "days"
sheds <- filter(d3, residence > 7) # filter out encounters equal to or longer than 7 consecutive days
len(sheds$TagID)
d3 <- filter(d2, !(TagID %in% sheds$TagID))
len(d3$TagID) # should be 221-6 = 215
d3 <- fishpaths(d3, d3$TagID, d3$Station)
beep(2)
d3 <- d3 %>%
arrange(arrival) %>%
mutate(detyear =
ifelse(
departure > "2011-07-01 00:00:00" & departure < "2012-06-30 00:00:00", "2011",
ifelse(
departure > "2012-07-01 00:00:00" & departure < "2013-06-30 00:00:00", "2012",
ifelse(
departure > "2013-07-01 00:00:00" & .$departure < "2014-06-30 00:00:00", "2013",
ifelse(
departure > "2014-07-01 00:00:00" & departure < "2015-06-30 00:00:00", "2014", "2015"
)
) )
head(select(d3, arrival, departure, detyear))
tail(select(d3, arrival, departure, detyear))
dp <- d3 %>%
group_by(detyear, TagID) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours"))
dp <- d3 %>%
filter(residence != 0) %>% # filter out single detections
group_by(detyear, TagID) %>%
arrange(arrival) %>%
mutate(transit_time = difftime(lead(arrival), departure, units = "hours")) %>%
ungroup()
range(dp$transit_time, na.rm = TRUE)
dp$transit_time <- as.numeric(dp$transit_time)
range(dp$transit_time, na.rm = TRUE)
dp <- dp %>%
group_by(detyear, TagID) %>%
arrange(arrival) %>%
filter(transit_time < 50*24, transit_time > 0) %>% # filters out transits greater than 50 days
mutate(move_num = cumsum(!duplicated(Station) | c(F, abs(diff(Rkm)) > 0.60))) %>% # skip the BC transits
ungroup() %>%
group_by(detyear, TagID, move_num) %>%
slice(length(move_num)) %>%
ungroup()
range(dp$transit_time) # we still have negative transit times, even after filtering for BC_joints - let's see what that's about:
dp2 <- dp %>%
group_by(detyear, TagID) %>%
arrange(move_num) %>%
mutate(diffRkm = abs(lead(Rkm) - Rkm),
rate = diffRkm/transit_time) %>%
ungroup %>%
filter(rate < 100)
range(dp2$rate, na.rm = TRUE)
ggplot(dp2, aes(x = Sp, y = rate)) +
geom_boxplot(alpha = 0.6) +
geom_jitter(aes(color = Sp), size = 2, width= 0.8,    alpha = 0.1) + facet_wrap(~detyear)
library(rethinking)
d1 <- filter(dp3, detyear == "2013")
d1$dSp <- ifelse(d1$Sp == "chn", 1, 0)
d1 <- as.data.frame(d1)
range(dp1$rate)
range(d1$rate)
m <- map(flist = alist(
rate ~ dnorm(mean = mu, sd = sigma) ,
mu <- a + bSp*dSp,
a ~ runif(0, 20) ,
bSp ~ dnorm(0, 5),
sigma ~ dunif(0,10)
),
start = list(a=1, sigma = 5), data = d1 )
precis(m) # shows an increase of 0.53km/hour for chinook than for white sturgeon.  But that's just in 2013, when there were many more chn than white sturgeon.
head(d1)
