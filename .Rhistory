View(firstlast)
View(sumary)
meanres <- firstlast %>%
group_by(Sp, TagID, year) %>%
summarise(totalres = departure[2] - arrival[1], avgres = mean(totalres))
View(meanres)
meanres <- firstlast %>%
group_by(TagID, year) %>%
mutate(totalres = departure[2] - arrival[1], avgres = mean(totalres)) %>%
ungroup() %>%
group_by(Sp, year) %>%
summarise(meanres = mean(totalres))
meanres
library(ybp)
library(fishtrackr)
library(dplyr)
library(lubridate)
library(tidyverse)
install.packages("tidyverse")
library(tidyverse)
library(lubridate)
a <- alltags
head(a)
?split
n <- 10; nn <- 100
g <- factor(round(n * runif(n * nn)))
x <- rnorm(n * nn) + sqrt(as.numeric(g))
xg <- split(x, g)
str(xg)
g
boxplot(xg, col = "lavender", notch = TRUE, varwidth = TRUE)
sapply(xg, length)
sapply(xg, mean)
groups <- split(a, `Tagging Group`)
groups <- split(a, a$`Tagging Group`)
str(groups)
names(groups)
?select
?base::select
?stats::select
??select
?utils::select.list
library(ybp)
library(fishtrackr)
library(tidyverse)
library(lubridate)
a <- alltags
head(a)
groups <- split(a, a$`Tagging Group`)
str(groups)
names(groups)
?map
g <- map_df(groups, select, TagID)
str(g)
g <- map(groups, select, TagID)
str(g)
names(g)
g[["fca_2012"]]
g$fca_2012
g$fca_2012$TagID
d <- all69khz_grouped
d2 <- filter(d, TagID %in% g$fca_2012$TagID)
head(d)
class(g$fca_2012$TagID) # theeerrrre it is
class(d$TagID)
d2 <- filter(d, TagID %in% g$fca_2012$TagID)
d2 <- filter_(d, d$TagID %in% g$fca_2012$TagID)
d2 <- filter_(d, g$fca_2012$TagID %in% d$TagID)
ids <- g$fca_2012$TagID # theeerrrre it is
d2 <- filter_(d, d$TagID %in% ids)
d2 <- filter(d, TagID %in% ids)
map_dbl(g, TagID)
map_dbl(g)
map_dbl(g, vector)
map_dbl(g, .$TagID)
map_dbl(g, TagID)
mtcars %>% map_dbl(sum)
unlist(g)
unlist(g, recursive = FALSE)
tags <- unlist(g, recursive = FALSE)
tags
tags$fca_2012
d2 <- filter(d, TagID %in% tags$fca_2012.TagID)
d3 <- filter(d, TagID %in% tags$wst_2012.TagID)
d3 <- d3 %>%
filter(DateTimeUTC > "2013-06-01 00:00:00", DateTimeUTC < "2014-05-31 23:59:59")
dstart = c("2011-07-01 00:00:00", "2012-07-01-00:00:00", "2013-07-01-00:00:00", "2014-07-01-00:00:00", "2015-07-01-00:00:00", "2016-07-01-00:00:00")
dstart = c("2011-07-01 00:00:00",
"2012-07-01 00:00:00",
"2013-07-01 00:00:00",
"2014-07-01 00:00:00",
"2015-07-01 00:00:00",
"2016-07-01 00:00:00")
dend <- c("2012-06-30 00:00:00",
"2013-06-30 00:00:00",
"2014-06-30 00:00:00",
"2015-06-30 00:00:00",
"2016-06-30 00:00:00",
"2017-06-30 00:00:00")
dend <- c("2012-06-30 00:00:00",
"2013-06-30 00:00:00",
"2014-06-30 00:00:00",
"2015-06-30 00:00:00",
"2016-06-30 00:00:00")
detyears <- as.data.frame(dstart, dend)
detyears <- data_frame(dstart, dend)
str(detyears)
detyears$detyear <- 2012:2017
str(detyears)
(detyears)
detyears$detyear <- 2011:2016
(detyears)
d3 <- filter(d, TagID %in% tags$wst_2012.TagID)
d3 <- d3 %>%
filter(DateTimeUTC > "2013-06-01 00:00:00", DateTimeUTC < "2014-05-31 23:59:59")
fp <- fishpaths(d, d$TagID, d$Station)
install.packages("zoo")
require(xts)
data(sample_matrix)
matrix_xts <- as.xts(sample_matrix,dateFormat='Date')
View(matrix_xts)
a <- alltags
head(a)
?split
groups <- split(a, a$`Tagging Group`)
str(groups)
names(groups)
g <- map(groups, select, TagID) # selects only the TagID column of each dataframe
tags <- unlist(g, recursive = FALSE) # have to unlist the first level to be able to manipulate with these as vectors
tags
#  Residence Time #
library(ybp)
library(fishtrackr)
library(tidyverse)
library(lubridate)
a <- alltags
head(a)
?split
groups <- split(a, a$`Tagging Group`)
str(groups)
names(groups)
g <- map(groups, select, TagID) # selects only the TagID column of each dataframe
tags <- unlist(g, recursive = FALSE) # have to unlist the first level to be able to manipulate with these as vectors
tags
?xts::first
library(xts)
library(tidyverse)
library(ybp)
library(fishtrackr)
d <- all69khz_grouped
?xts
d <- arrange(d, DateTimeUTC)
str(d)
Sys.getenv()
?Sys.getenv
Sys.setenv(TZ = 'Pacific/Pitcairn')
?xts
d <- xts(d, order.by = index(d))
d <- xts(d, order.by = index(d$DateTimeUTC))
dindex <- d$DateTimeUTC
str(dindex)
d <- xts(d, order.by = index(dindex))
d <- xts(d)
head(sample_matrix)
data("sample_matrix")
head(sample_matrix)
d <- as.matrix(d)
head(d)
str(d)
str(sample_matrix)
d <- xts(d)
class(sample_matrix)
head(sample_matrix)
head(d)
?as.matrix
rownames(sample_matrix)
d <- all69khz_grouped
d <- arrange(d, DateTimeUTC)
str(d)
rownames(d) <- d$DateTimeUTC
d <- all69khz_grouped
d <- arrange(d, DateTimeUTC)
d <- as.xts(d[, -1], order.by = d[, 1] )
head(d)
class(d)
d <- all69khz_grouped
d <- arrange(d, DateTimeUTC)
str(d)
rownames(d) <- d[[1]]
?rownames
d <- all69khz_grouped
d <- arrange(d, DateTimeUTC)
str(d)
dx <- xts(d[, -1], order.by=as.POSIXct(d$DateTimeUTC))
head(dx)
library(xts)
library(tidyverse)
library(ybp)
library(fishtrackr)
Sys.setenv(TZ = 'Pacific/Pitcairn')
d <- all69khz_grouped
d <- arrange(d, DateTimeUTC)
str(d)
dx <- xts(d[, -1], order.by=as.POSIXct(d$DateTimeUTC))
str(dx)
head(dx["Receiver"])
head(dx[["Receiver"]])
head(dx$Reciever)
head(dx$Receiver)
indexTZ(d)
indexTZ(dx)
dx[, 1]
indexTZ(dx) <- "Pacific/Pitcairn"
indexTZ(dx)
head(index(TZ))
head(index(dx))
head(d$DateTimeUTC)
periodicity(dx)
a <- alltags
head(a)
groups <- split(a, a$`Tagging Group`)
g <- map(groups, select, TagID) # selects only the TagID column of each dataframe
tags <- unlist(g, recursive = FALSE) # have to unlist the first level to be able to manipulate with these as vectors
tags
d <- all69khz_grouped
head(d)
d3 <- filter(d, TagID %in% tags$wst_2012.TagID) # contains all the detections for this tagging group - have to filter further by year
wst13 <- d3 %>%
filter(DateTimeUTC > "2013-06-01 00:00:00", DateTimeUTC < "2014-05-31 23:59:59")
fp_wst13 <- fishpaths(wst13, wst13$TagID, wst13$Station)
head(fp_wst13)
wst12 <- d3 %>%
filter(DateTimeUTC > "2011-06-01 00:00:00", DateTimeUTC < '2012-05-31 23:59:59')
fp_wst12 <- fishpaths(wst12, wst12$TagID, wst12$Station)
fp_wst12$residence <- fp_wst12$departure - fp_wst12$arrival
units(fp_wst12$residence) <- "days"
firstlast <- fp_wst12 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure)))
firstlast_wst12 <- fp_wst12 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure)))
head(firstlast_wst12)
meanres_wst12 <- firstlast_wst12 %>%
group_by(TagID) %>%
mutate(totalres = departure[2] - arrival[1], avgres = mean(totalres)) %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres))
meanres_wst12
meanres_wst12 <- firstlast_wst12 %>%
group_by(TagID) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres))
meanres_wst12
wst13 <- d3 %>%
filter(DateTimeUTC > "2013-06-01 00:00:00", DateTimeUTC < "2014-05-31 23:59:59")
fp_wst13 <- fishpaths(wst13, wst13$TagID, wst13$Station)
head(fp_wst13)
meanres_wst12 <- firstlast_wst12 %>%
group_by(TagID) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = lun(TagID))
meanres_wst12 <- firstlast_wst12 %>%
group_by(TagID) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID))
meanres_wst12
wst13 <- d3 %>%
filter(DateTimeUTC > "2013-06-01 00:00:00", DateTimeUTC < "2014-05-31 23:59:59")
fp_wst13 <- fishpaths(wst13, wst13$TagID, wst13$Station)
head(fp_wst13)
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure))) # slices the row of the earliest arrival and the latest departure
meanres_wst13 <- firstlast_wst13 %>%
group_by(TagID) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # need to properly assign year(s) to these data
meanres_wst12
meanres_wst13
getres <- function(d, detyear_start, detyear_end) {
# d = a dataframe that's been filtered for your Tagging Group
# detyear_start = start of the detection year, i.e. "2011-06-01 00:00:00"
# detyear_end = end of the detection year
d_filtered <- filter_(d, ~DateTimeUTC > as.POSIXct(detyear_start), ~DateTimeUTC < as.POSIXct(detyear_end))
d_fp <- fishpaths(d_filtered, d_filtered$TagID, d_filtered$Station)
firstlast <- d_fp %>%
group_by_(~TagID) %>%
arrange_(~arrival, ~departure) %>%
slice_(c(1, length(~departure)))
}
fl_test <- getres(d3, "2011-06-01 00:00:00", '2012-05-31 23:59:59')
getres <- function(d, detyear_start, detyear_end) {
# d = a dataframe that's been filtered for your Tagging Group
# detyear_start = start of the detection year, i.e. "2011-06-01 00:00:00"
# detyear_end = end of the detection year
d_filtered <- filter_(d, ~DateTimeUTC > as.POSIXct(detyear_start), ~DateTimeUTC < as.POSIXct(detyear_end))
d_fp <- fishpaths(d_filtered, d_filtered$TagID, d_filtered$Station)
d_fp$residence <- d_fp$departure - d_fp$arrival
units(d_fp$residence) <- "days"
firstlast <- d_fp %>%
group_by_(~TagID) %>%
arrange_(~arrival, ~departure) %>%
slice_(c(1, length(~departure)))
}
fl_test <- getres(d3, "2011-06-01 00:00:00", '2012-05-31 23:59:59')
# By hand: except for 2012, detection years start on July 1st ever year, and end on June 30th.
dstart = c("2011-07-01 00:00:00",
"2012-07-01 00:00:00",
"2013-07-01 00:00:00",
"2014-07-01 00:00:00",
"2015-07-01 00:00:00",
"2016-07-01 00:00:00")
dend <- c("2012-06-30 00:00:00",
"2013-06-30 00:00:00",
"2014-06-30 00:00:00",
"2015-06-30 00:00:00",
"2016-06-30 00:00:00")
detyears <- data_frame(dstart, dend)
detyears$detyear <- 2011:2016
(detyears)
# By hand: except for 2012, detection years start on July 1st ever year, and end on June 30th.
dstart = c("2011-07-01 00:00:00",
"2012-07-01 00:00:00",
"2013-07-01 00:00:00",
"2014-07-01 00:00:00",
"2015-07-01 00:00:00",
"2016-07-01 00:00:00")
dend <- c("2012-06-30 00:00:00",
"2013-06-30 00:00:00",
"2014-06-30 00:00:00",
"2015-06-30 00:00:00",
"2016-06-30 00:00:00",
"2017-06-30 00:00:00")
detyears <- data_frame(dstart, dend)
detyears$detyear <- 2011:2016
(detyears)
meanres_wst12_combinedchain <-
fp_wst12 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID))
meanres_wst12
meanres_wst12_combinedchain
a <- alltags
groups <- split(a, a$`Tagging Group`)
g <- map(groups, select, TagID) # selects only the TagID column of each dataframe
tags <- unlist(g, recursive = FALSE) # have to unlist the first level to be able to manipulate with these as vectors
tags
d3 <- filter(d, TagID %in% tags$wst_2012.TagID | TagID %in% tags$wst_2014.TagID) # contains all the detections for both tagging groups of white sturgeon - still have to filter further by year to get residence
wst12 <- d3 %>%
filter(DateTimeUTC > "2011-06-01 00:00:00", DateTimeUTC < '2012-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst12 <- fishpaths(wst12, wst12$TagID, wst12$Station)
meanres_wst12 <-
fp_wst12 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
meanres_wst12
wst13 <- d3 %>%
filter(DateTimeUTC > "2012-06-01 00:00:00", DateTimeUTC < '2013-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst13 <- fishpaths(wst13, wst13$TagID, wst13$Station)
meanres_wst13 <-
fp_wst13 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
meanres_wst13
wst13 <- d3 %>%
filter(DateTimeUTC > "2012-06-01 00:00:00", DateTimeUTC < '2013-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst13 <- fishpaths(wst13, wst13$TagID, wst13$Station)
meanres_wst13 <-
fp_wst13 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
units(totalres) <- "days" %>%
ungroup() %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
wst13 <- d3 %>%
filter(DateTimeUTC > "2012-06-01 00:00:00", DateTimeUTC < '2013-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst13 <- fishpaths(wst13, wst13$TagID, wst13$Station)
firstlast_wst13 <-
fp_wst13 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup()
units(firstlast_wst13$totalres) <- "days"
meanres_wst13 <- firstlast_wst13 %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
meanres_wst13
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup()
View(firstlast_wst13)
View(fp_wst13)
wst13 <- d3 %>%
filter(DateTimeUTC > "2012-06-01 00:00:00", DateTimeUTC < '2013-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst13 <- fishpaths(wst13, wst13$TagID, wst13$Station)
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
arrange(arrival) %>%
slice(c(1, length(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup()
units(firstlast_wst13$totalres) <- "days"
meanres_wst13 <- firstlast_wst13 %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
meanres_wst13
wst13 <- d3 %>%
filter(DateTimeUTC > "2012-06-01 00:00:00", DateTimeUTC < '2013-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst13 <- fishpaths(wst13, wst13$TagID, wst13$Station)
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
slice(c(1, length(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup()
units(firstlast_wst13$totalres) <- "days"
meanres_wst13 <- firstlast_wst13 %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
meanres_wst13
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
slice(c(arrival == min(arrival), departure == max(departure))) %>%
mutate(totalres = departure[2] - arrival[1]) %>%
ungroup()
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
summarise(firstarrival == min(arrival), lastdeparture == max(departure)))
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
summarise(firstarrival == min(arrival), lastdeparture == max(departure))
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
summarise(firstarrival = min(arrival), lastdeparture = max(departure))
firstlast_wst13 <- fp_wst13 %>%
group_by(TagID) %>%
summarise(firstarrival = min(arrival), lastdeparture = max(departure)) %>%
mutate(totalres = lastdeparture - firstarrival)
units(firstlast_wst13$totalres) <- "days"
meanres_wst13 <- firstlast_wst13 %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
meanres_wst13
wst12 <- d3 %>%
filter(DateTimeUTC > "2011-06-01 00:00:00", DateTimeUTC < '2012-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst12 <- fishpaths(wst12, wst12$TagID, wst12$Station)
firstlast_wst12 <- fp_wst12 %>%
group_by(TagID) %>%
summarise(firstarrival = min(arrival), lastdeparture = max(departure)) %>%
mutate(totalres = lastdeparture - firstarrival)
units(firstlast_wst12$totalres) <- "days"
meanres_wst12 <- firstlast_wst12 %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
meanres_wst12
# White sturgeon residence in 2014:
wst14 <- d3 %>%
filter(DateTimeUTC > "2013-06-01 00:00:00", DateTimeUTC < '2014-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst14 <- fishpaths(wst14, wst14$TagID, wst14$Station)
firstlast_wst14 <- fp_wst14 %>%
group_by(TagID) %>%
summarise(firstarrival = min(arrival), lastdeparture = max(departure)) %>%
mutate(totalres = lastdeparture - firstarrival)
units(firstlast_wst14$totalres) <- "days"
meanres_wst14 <- firstlast_wst14 %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID)) # works; move to new script to complete calculations
meanres_wst14
# White sturgeon residence in 2014-2015:
wst15 <- d3 %>%
filter(DateTimeUTC > "2014-06-01 00:00:00", DateTimeUTC < '2015-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst15 <- fishpaths(wst15, wst15$TagID, wst15$Station)
firstlast_wst15 <- fp_wst15 %>%
group_by(TagID) %>%
summarise(firstarrival = min(arrival), lastdeparture = max(departure)) %>%
mutate(totalres = lastdeparture - firstarrival)
units(firstlast_wst15$totalres) <- "days"
meanres_wst15 <- firstlast_wst15 %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID))
meanres_wst15
# White sturgeon residence in 2015-2016:
wst16 <- d3 %>%
filter(DateTimeUTC > "2015-06-01 00:00:00", DateTimeUTC < '2016-05-31 23:59:59') # keep in mind that this is all in UTC still
fp_wst16 <- fishpaths(wst16, wst16$TagID, wst16$Station)
firstlast_wst16 <- fp_wst16 %>%
group_by(TagID) %>%
summarise(firstarrival = min(arrival), lastdeparture = max(departure)) %>%
mutate(totalres = lastdeparture - firstarrival)
units(firstlast_wst16$totalres) <- "days"
meanres_wst16 <- firstlast_wst16 %>%
summarise(meanres = mean(totalres), sdres = sd(totalres), n = len(TagID))
meanres_wst16
