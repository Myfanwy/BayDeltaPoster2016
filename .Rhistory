library(ybp)
library(fishtrackr)
f <- all69khz_grouped
head(f)
library(dplyr)
library(lubridate)
f$year <- year(DateTagged)
f$year <- year(f$DateTagged)
f <- filter(f, year == 2012)
f <- select(f, -year)
f2 <- fishpaths(f, f$TagID, f$Station)
head(f2)
f2 <- f2 %>%
arrange(arrival) %>%
filter(Sp == "wst")
View(f2)
f2 <- f2 %>%
group_by(TagID) %>%
arrange(arrival) %>%
filter(Sp == "wst")
View(f2)
f2 <- arrange(f2, TagID, arrival)
w2 <- filter(f, TagID == 2844)
head(w2)
unique(w2$Station)
w2 <- filter(w2, Station == 'BC_joint')
head(w2)
View(w2)
f <- all69khz
f$year <- year(f$DateTagged)
f <- filter(f, year == 2012)
f <- select(f, -year)
f2 <- fishpaths(f, f$TagID, f$Station)
head(f2)
f2 <- f2 %>%
group_by(TagID) %>%
arrange(arrival) %>%
filter(Sp == "wst")
f2 <- arrange(f2, TagID, arrival)
w2 <- filter(f, TagID == 2844)
head(w2)
unique(w2$Station)
w2 <- filter(w2, Station == 'BCE' | Station == "BCW")
View(w2)
w2dups <- filter(duplicated(w2$DateTimeUTC))
w2dups <- w2[duplicated(w2$DateTimeUTC), ]
View(w2dups)
head(w2)
w2paths <- fishpaths(w2, w2$TagID, w2$Station)
head(w2paths)
w2paths$residence = w2paths$departure - w2paths$arrival
head(w2paths)
total = sum(w2paths$residence)
total
w2 <- w2[!duplicated(w2$DateTimeUTC), ]
w2paths <- fishpaths(w2, w2$TagID, w2$Station)
w2paths$residence = w2paths$departure - w2paths$arrival
total_sansdups = sum(w2paths$residence)
total_sansdups
41628/60
f <- all69khz
f$year <- year(f$DateTagged)
f <- filter(f, year == 2012)
f <- select(f, -year)
f2 <- fishpaths(f, f$TagID, f$Station)
head(f2)
f2 <- f2 %>%
group_by(TagID) %>%
arrange(TagID, arrival) %>%
filter(Sp == "wst")
w2 <- filter(f, TagID == 2844)
w2 <- filter(w2, Station == 'BCE' | Station == "BCW")
w2dups <- w2[duplicated(w2$DateTimeUTC), ] # this pulled all the BCE detections - there are 60 matching BCW detections to these
head(w2)
w2paths <- fishpaths(w2, w2$TagID, w2$Station)
head(w2paths)
w2paths$residence = w2paths$departure - w2paths$arrival
total = sum(w2paths$residence)
total
w22 <- w2[!duplicated(w2$DateTimeUTC), ]
w22paths <- fishpaths(w22, w22$TagID, w22$Station)
w22paths$residence = w22paths$departure - w22paths$arrival
total_sansdups = sum(w22paths$residence)
total_sansdups
units(total_sansdups) <- "mins"
total_sansdups
total - total_sansdups
duppaths <- fishpaths(w2dups, w2dups$TagID, w2dups$Station)
duppaths$residence = duppaths$departure - duppaths$arrival
duppaths
w2 <- arrange(w2, DateTimeUTC)
w2$DateTimeUTC[390] - w2$DateTimeUTC[1]
total
total/60
units(total) <- "days"
total
units(total_sansdups) <- "days"
total_sansdups
f <- all69khz
f$year <- year(f$DateTagged)
f <- filter(f, year == 2012)
f %>%
arrange(DateTimeUTC) %>%
group_by(TagID, Station)  %>%
mutate(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)])
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID, Station)  %>%
mutate(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)]) %>%
ungroup() %>%
filter(!duplicated(TagID))
View(sumary)
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
mutate(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)]) %>%
ungroup() %>%
filter(!duplicated(TagID))
View(sumary)
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
mutate(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)]) %>%
ungroup() %>%
summarise(TagID = TagID, firstloc = first, finalloc = last)
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
mutate(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)]) %>%
filter(., unique(TagID))
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
mutate(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)]) %>%
filter(unique(TagID))
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
mutate(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)])
head(sumary)
tail(sumary)
sumary <- f2 %>%
group_by(TagID)  %>%
mutate(first = f2$Station[f2$arrival == min(f2$arrival)], last = f2$Station[f$departure == max(f2$departure)])
head(sumary)
sumary <- f2 %>%
group_by(TagID)  %>%
mutate(first = f2$Station[f2$arrival == min(f2$arrival)], last = f2$Station[f$departure == max(f2$departure)]) %>%
select(TagID, first, last)
head(sumary)
group_by
group_by_
test <- filter(f, TagID == 2844)
sumary <- test %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
mutate(first = test$Station[test$DateTimeUTC == min(test$DateTimeUTC)], last = test$Station[test$DateTimeUTC == max(test$DateTimeUTC)])
head(sumary)
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by_(f$TagID)  %>%
mutate_(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)])
sumary <- f %>%
arrange_(f$DateTimeUTC) %>%
group_by_(f$TagID)  %>%
mutate_(first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)])
sumary <- f %>%
arrange_(f$DateTimeUTC) %>%
group_by_(f$TagID)  %>%
mutate_(f$first = f$Station[f$DateTimeUTC == min(f$DateTimeUTC)], f$last = f$Station[f$DateTimeUTC == max(f$DateTimeUTC)])
sumary <- tapply(f$DateTimeUTC, x$TagID, FUN=min)
sumary <- tapply(f$DateTimeUTC, f$TagID, FUN=min)
head(sumary) # okay so for some reason it's not actually grouping by the TagID
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
slice(c(1,length(DateTimeUTC)))
View(sumary)
firstlast <- sumary %>%
group_by(TagID) %>%
mutate(first = Station[1], last = Station[2])
head(firstlast)
firstlast <- sumary %>%
group_by(TagID) %>%
mutate(first = Station[1], last = Station[2]) %>%
select(TagID, Sp, year, first, last)
head(firstlast)
firstlast <- sumary %>%
group_by(TagID) %>%
mutate(first = Station[1], last = Station[2]) %>%
filter(!duplicated(TagID)) %>%
select(TagID, Sp, year, first, last)
head(firstlast)
firstlast %>%
group_by(last) %>%
summarise(count = n())
firstlast %>%
group_by(year, Sp, last) %>%
summarise(count = n())
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
slice(c(1, length(DateTimeUTC)))
firstlast <- sumary %>%
group_by(TagID) %>%
mutate(first = Station[1], last = Station[2]) %>%
filter(!duplicated(TagID)) %>%
select(TagID, Sp, year, first, last)
head(firstlast)
firstlast %>%
group_by(year, Sp, last) %>%
summarise(count = n())
library(ybp)
library(fishtrackr)
library(dplyr)
library(lubridate)
f <- all69khz
f$year <- year(f$DateTagged)
f <- filter(f, year == 2012)
f <- select(f, -year)
f2 <- fishpaths(f, f$TagID, f$Station)
head(f2)
f <- filter(f, TagID == 2844)
f <- select(f, -year)
f <- all69khz
f$year <- year(f$DateTagged)
f <- filter(f, year == 2012)
f <- filter(f, TagID == 2844)
f <- select(f, -year)
f2 <- fishpaths(f, f$TagID, f$Station)
head(f2)
fsdups <- filter(f, !duplicated(DateTimeUTC))
f3 <- fishpaths(fsdups, fsdups$TagID, fsdups$Station)
identical(f2, f3)
f2$residence = f2$departure - f2$arrival
f3$residence = f3$departure - f3$arrival
f3$res_runsum = cumsum(f3$residence)
View(f2)
head(f2)
units(f2$residence) <- "days"
units(f3$residence) <- "days"
f3$res_runsum = cumsum(as.numeric(f3$residence))
View(f3)
f2$res_runsum = cumsum(as.numeric(f2$residence))
View(f)
View(fsdups)
?case_when
x <- 1:50
case_when(
x %% 35 == 0 ~ "fizz buzz",
x %% 5 == 0 ~ "fizz",
x %% 7 == 0 ~ "buzz",
TRUE ~ as.character(x)
)
case_when(
TRUE ~ as.character(x),
x %%  5 == 0 ~ "fizz",
x %%  7 == 0 ~ "buzz",
x %% 35 == 0 ~ "fizz buzz"
)
dups <- f2 %>%
group_by(arrival) %>%
filter(duplicated(arrival))
dups
maxdups <- f2 %>%
group_by(arrival) %>%
slice(which.max(departure))
dups
maxdups
maxdups <- f2 %>%
group_by(arrival) %>%
case_when(duplicated(arrival), slice(which.max(departure)))
maxdups <- f2 %>%
group_by(arrival) %>%
case_when(duplicated(.$arrival), slice(which.max(.$departure)))
head(f2) # this dataframe contains duplicate arrival times.
maxdups <- f2 %>%
group_by(arrival) %>%
slice(which.max(departure))
head(maxdups)
maxdups[1:8]
maxdups[1:4]
maxdups[1:8,]
f2[1:8, ]
View(maxdups)
?cummax
?lead
lead(1:10, 1)
lead(1:10, 2)
lag(1:10, 1)
lead(1:10, 1)
1:10
lag(1:10, 1)
lead(1:10, 1)
x <- runif(5)
cbind(ahead = lead(x), x, behind = lag(x))
rm_overlaps <- f2 %>%
group_by(TagID) %>%
mutate(indx = c(0, cumsum(as.numeric(lead(arrival)) >
cummax(as.numeric(departure)))[-n()] ))
View(rm_overlaps)
rm_overlaps <- arrange(rm_overlaps, arrival, deparute)
rm_overlaps <- arrange(rm_overlaps, arrival, departure)
rm_overlaps <- f2 %>%
group_by(TagID) %>%
mutate(indx = c(0, cumsum(as.numeric(lead(arrival)) >
cummax(as.numeric(departure)))[-n()] ))
rm_overlaps <- f2 %>%
group_by(TagID) %>%
arrange(arrival, departure) %>%
mutate(indx = c(0, cumsum(as.numeric(lead(arrival)) >
cummax(as.numeric(departure)))[-n()] ))
f <- all69khz_grouped
f$year <- year(f$DateTagged)
f <- filter(f, year == 2012)
f <- filter(f, TagID == 2844)
f <- select(f, -year)
f2 <- fishpaths(f, f$TagID, f$Station)
head(f2) # this dataframe contains duplicate arrival times.
f <- all69khz_grouped
library(beepr)
f2 <- fishpaths(f, f$TagID, f$Station)
beep(7)
firstlast <- f2 %>%
mutate(year = year(DateTagged)) %>%
group_by(year, TagID) %>%
summarise(TagID = TagID, year = year, first = Station[arrival == min(arrival)], last = Station[departure == max(departure)])
firstlast <- f2 %>%
mutate(year = year(DateTagged)) %>%
group_by(year, TagID) %>%
summarise(first = .$Station[arrival == min(arrival)], last = .$Station[departure == max(departure)])
firstlast <- f2 %>%
mutate(year = year(DateTagged)) %>%
group_by(year, TagID) %>%
summarise(first = .$Station[.$arrival == min(.$arrival)], last = .$Station[.$departure == max(.$departure)])
View(firstlast)
firstlast <- f2 %>%
mutate(year = year(DateTagged)) %>%
group_by(year, TagID) %>%
slice(c(1, length(departure)))
sumary <- f %>%
arrange(DateTimeUTC) %>%
group_by(TagID)  %>%
slice(c(1, length(DateTimeUTC)))
View(firstlast)
View(sumary)
firstlast <- f2 %>%
mutate(year = year(DateTagged)) %>%
group_by(year, TagID) %>%
arrange(arrival, departure) %>%
slice(c(1, length(departure)))
View(firstlast)
View(sumary)
meanres <- firstlast %>%
group_by(Sp, TagID, year) %>%
summarise(totalres = departure[2] - arrival[1], avgres = mean(totalres))
View(meanres)
meanres <- firstlast %>%
group_by(TagID, year) %>%
mutate(totalres = departure[2] - arrival[1], avgres = mean(totalres)) %>%
ungroup() %>%
group_by(Sp, year) %>%
summarise(meanres = mean(totalres))
meanres
